<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AI Log Insight Service</title>
    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f5f7;
        }

        .container {
            max-width: 900px;
            margin: 40px auto;
            background: #ffffff;
            border-radius: 16px;
            padding: 24px 28px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.06);
        }

        h1 {
            margin-top: 0;
            font-size: 24px;
        }

        p.description {
            color: #555;
            margin-top: 4px;
            margin-bottom: 16px;
        }

        label {
            font-weight: 600;
            display: block;
            margin-bottom: 4px;
        }

        textarea {
            width: 100%;
            min-height: 200px;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-family: monospace;
            font-size: 13px;
            resize: vertical;
        }

        button {
            margin-top: 16px;
            padding: 10px 18px;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }

        button#analyzeBtn {
            background: #2563eb;
            color: white;
        }

        button#analyzeBtn:disabled {
            opacity: 0.6;
            cursor: default;
        }

        .status {
            margin-top: 8px;
            font-size: 13px;
            color: #666;
        }

        .results {
            margin-top: 24px;
            border-top: 1px solid #eee;
            padding-top: 16px;
        }

        .results h2 {
            font-size: 18px;
            margin-top: 0;
        }

        .card {
            background: #f9fafb;
            border-radius: 12px;
            padding: 12px 14px;
            margin-bottom: 10px;
        }

        .card h3 {
            margin: 0 0 6px 0;
            font-size: 14px;
        }

        .card p, .card ul {
            margin: 0;
            font-size: 13px;
        }

        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 999px;
            background: #e5e7eb;
            font-size: 11px;
            margin-left: 6px;
            color: #555;
        }

        pre {
            background: #111827;
            color: #e5e7eb;
            border-radius: 8px;
            padding: 10px;
            font-size: 12px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>AI Log Insight Service</h1>
    <p class="description">
        Paste your application logs below and get an AI-generated summary, key errors, probable causes,
        and suggested next steps.
    </p>

    <label for="logs">Logs</label>
    <textarea id="logs" placeholder="Paste your logs here..."></textarea>

    <button id="analyzeBtn">Analyze Logs</button>
    <div class="status" id="statusText"></div>

    <div class="results" id="results" style="display: none;">
        <h2>Analysis Result</h2>

        <div class="card">
            <h3>Summary</h3>
            <p id="summaryText"></p>
        </div>

        <div class="card">
            <h3>Key Errors <span class="badge" id="errorsCount"></span></h3>
            <ul id="errorsList"></ul>
        </div>

        <div class="card">
            <h3>Probable Causes <span class="badge" id="causesCount"></span></h3>
            <ul id="causesList"></ul>
        </div>

        <div class="card">
            <h3>Suggested Next Steps <span class="badge" id="stepsCount"></span></h3>
            <ul id="stepsList"></ul>
        </div>

        <details style="margin-top: 12px;">
            <summary style="cursor: pointer; font-size: 13px;">View raw JSON response</summary>
            <pre id="rawJson"></pre>
        </details>
    </div>
</div>

<script>
    const analyzeBtn = document.getElementById('analyzeBtn');
    const logsInput = document.getElementById('logs');
    const statusText = document.getElementById('statusText');
    const resultsDiv = document.getElementById('results');

    const summaryText = document.getElementById('summaryText');
    const errorsList = document.getElementById('errorsList');
    const causesList = document.getElementById('causesList');
    const stepsList = document.getElementById('stepsList');

    const errorsCount = document.getElementById('errorsCount');
    const causesCount = document.getElementById('causesCount');
    const stepsCount = document.getElementById('stepsCount');
    const rawJson = document.getElementById('rawJson');

    analyzeBtn.addEventListener('click', async () => {
        const logs = logsInput.value.trim();
        if (!logs) {
            statusText.textContent = "Please paste some logs before analyzing.";
            return;
        }

        analyzeBtn.disabled = true;
        statusText.textContent = "Analyzing logs with AI...";
        resultsDiv.style.display = 'none';

        try {
            const response = await fetch('/api/logs/analyze', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ logs: logs })
            });

            if (!response.ok) {
                const errorText = await response.text();
                statusText.textContent = "Something went wrong: " + response.status + " " + errorText;
                analyzeBtn.disabled = false;
                return;
            }

            const data = await response.json();

            summaryText.textContent = data.summary || "(no summary)";
            fillList(errorsList, errorsCount, data.keyErrors);
            fillList(causesList, causesCount, data.probableCauses);
            fillList(stepsList, stepsCount, data.suggestedNextSteps);

            rawJson.textContent = JSON.stringify(data, null, 2);

            resultsDiv.style.display = 'block';
            statusText.textContent = "Analysis complete.";
        } catch (e) {
            console.error(e);
            statusText.textContent = "Unexpected error while calling the API.";
        } finally {
            analyzeBtn.disabled = false;
        }
    });

    function fillList(listElement, badgeElement, items) {
        listElement.innerHTML = "";
        const arr = Array.isArray(items) ? items : [];
        badgeElement.textContent = arr.length + " item" + (arr.length === 1 ? "" : "s");

        if (arr.length === 0) {
            const li = document.createElement('li');
            li.textContent = "(none)";
            listElement.appendChild(li);
            return;
        }

        arr.forEach(item => {
            const li = document.createElement('li');
            li.textContent = item;
            listElement.appendChild(li);
        });
    }
</script>
</body>
</html>
